<% 
# signup new account
@return_message = {}
begin
	h = {
		:companyname => @body['companyname'],
		:username => @body['username'],
		:email => @body['email'],
		:password => @body['password']
	}
	login = BlackStack::MySaaS::Account.signup(h, false) # false: don't send notificaitons

	if login.nil?
		raise 'Account creation failed.'
	end

	if @body['api_key']
		acc = login.user.account
		acc.api_key = @body['api_key']
		acc.save
	end

	@return_message['status'] = 'success'
rescue => e
    @return_message['status'] = @body['backtrace'] ? e.to_console : e.message
end
return @return_message.to_json
%>