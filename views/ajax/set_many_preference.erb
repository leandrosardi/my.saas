<%
return_message = {}
return_message['status'] = 'success'
begin
    N = 25
    preferences = @body['preferences']
    default = '' #@body['default']

    raise "preferences is required" if preferences.nil?
    raise "preferences must be an array" unless preferences.is_a?(Array) 
    raise "preferences cannot contains more than #{N} elements" if preferences.size > N
    
    preferences.each { |h| 
        name = h['name']
        default = h['default']
        value = h['value']
        raise "name must be a String" unless name.is_a?(String)
        raise "value cannot be nil" if value.nil?
        raise "default cannot be nil" if default.nil?
        raise "value and default must be of the same type" unless value.class == default.class    
    }

    preferences.each { |h|
        name = h['name']
        default = h['default']
        value = h['value']
        @login.user.preference(name, default, value)
    }
rescue => e
    return_message[:status] = e.to_console
end
return return_message.to_json
%>
