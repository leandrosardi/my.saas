# All your secrets are in this file.
# Keep it safe into a PRIVATE repository.
#
# This `BlackOpsFile` is an example for
# installing my.saas into one single computer.
#

# API key of My.SaaS super-user
# IMPORTANT: Replace this value by a new and unique key.
#
SU_API_KEY = '98c60163-5555-5555-5555-a7fa823f459f'

# Used to sign and encrypt session cookies for security. This should be a long,
# random, and unique string. In production, do NOT hardcode this — Setup it in
# your BlackOpsFile.
#
# IMPORTANT: Replace this value by a new and unique key.
#
SESSION_SECRET = '000b6013-bbc9-412a-816c-c3eea0c0c68a'

# Since [BlackOps](https://github.com/leandrosardi/blackops) 
# connect such a node via SSH, you can define the IP
# of a remote computer.
#
SSH_IP = 'localhost'
SSH_USERNAME = 'mysaas'
SSH_PASSWORD = 'mysaas'
SSH_PORT = 22
SSH_ROOT_PASSWORD = ENV["MYSAAS_ROOT_PASSWORD"]

# Write the password for the `mysaas` user of your postgresql
# IMPORTANT: Edit the value of `POSTGRES_PASSWORD` with a strong password.
# 
POSTGRES_URL = 'localhost'
POSTGRES_PORT = 5432
POSTGRES_USERNAME = 'mysaas'
POSTGRES_PASSWORD = 'mysaas'
POSTGRES_DATABASE = 'mysaas'

# Git credentials.
# Uncomment this piece of code if your operations require to download from a private repository.
# 
#GIT_USERNAME = '<write-here>'
#GIT_PASSWORD = '<write-here>'

# Transactional emails
# Uncomment this piece of code if you implement transactional emails.
# 
#SMTP_URL = '<write-here>'
#SMTP_PORT = '<write-here>'
#SMTP_USERNAME = '<write-here>'
#SMTP_PASSWORD = '<write-here>'
#SMTP_SENDER_EMAIL = '<write-here>'
#SMTP_FROM_EMAIL = '<write-here>'
#SMTP_FROM_NAME = '<write-here>'

# BlackOps Configurations
#
# Define one or more locations to find the `.op` files.
# Locations may be paths in your local disk or URLs.
#
# Don't use `https` for remote paths (URLs) because it 
# have SSL certificate issues. Simplify your life and use `http`.
#
BlackOps.set(
    repositories: [
        #'http://raw.githubusercontent.com/leandrosardi/blackops/refs/heads/main/ops',
        './',
    ],
)

# Re-usable templates for Node-Descriptions
#
@t = {
    # ssh credentials to production nodes.
    :ssh => {
        # SSH credentials.
        # Root password is required to install the environment at the first time.
        #
        # Mandatory. The 4 keys below are mandatory.
        #
        # Allowed values:
        # - ssh_username: string with a valid Linus user name,
        # - ssh_port: integer with a valid port number
        #
        :ssh_username => SSH_USERNAME,
        :ssh_port => SSH_PORT,

        # IMPORTANT: for ssh passwords, it is a good practice to define unique values for each node.
        #
        # - ssh_password: string with a valid Linux password.
        # - ssh_root_password: string with a valid Linux password.

        # NOTE: In a local environment, the master, slave and worker
        # share same domain, ssh password and postgres password.
        #
        # ssh passwords
        :ssh_password => SSH_PASSWORD,
        :ssh_root_password => SSH_ROOT_PASSWORD,
    },

    # PostgreSQL credentials.
    :postgres => {
        :postgres_url => POSTGRES_URL,
        :postgres_port => POSTGRES_PORT,
        :postgres_database => POSTGRES_DATABASE,
        :postgres_username => POSTGRES_USERNAME,
        :postgres_password => POSTGRES_PASSWORD,
    },

    # Git credentials.
    # Uncomment this piece of code if your operations require to download from a private repository.
    # 
=begin
    :git => {
        :git_username => GIT_USERNAME,
        :git_password => GIT_PASSWORD,
    },
=end

    # Transactional emails
    # Uncomment this piece of code if you implement transactional emails.
    # 
=begin
    :emails => {
        :smtp_url => SMTP_URL,
        :smtp_port => SMTP_PORT,
        :smtp_user => SMTP_USERNAME,
        :smtp_password => SMTP_PASSWORD,

        :sender_email => SMTP_SENDER_EMAIL,
        :from_email => SMTP_FROM_EMAIL,
        :from_name => SMTP_FROM_NAME,

        :tracking_domain_protocol => 'https',
        :tracking_domain_tld => 'localhost',
        :tracking_domain_port => 3000,

        :logo_url => 'https://massprospecting.com/mass.account/images/logo.png',
        :signature_picture_url => 'https://raw.githubusercontent.com/MassProspecting/docs/refs/heads/main/assets/marketing/leandro5-rounded.png',
        :signature_name => 'Leandro D. Sardi',
        :signature_position => 'Founder & CEO',
    },
=end

    # Invoicing and payments processing
    # Uncomment this piece of code if you implement payments processing.
    # 
=begin
    :i2p => {
        # paypal
        :paypal_ipn_listener => 'https://b5f4-181-164-172-11.ngrok-free.app',
        :paypal_business_email => 'sardi.leandro.daniel-facilitator@gmail.com',
        :paypal_orders_url => 'https://sandbox.paypal.com',
    }, 
=end

    # Monitoring
    # Uncomment this piece of code if you implement transactional emails.
    # 
=begin
    :monitoring => {
        :cpu_threshold => 50,
        :ram_threshold => 50,
        :disk_threshold => 50,

        :procs => [
            #'ruby ./extensions/i2p/p/baddebt.rb',
            #'ruby ./extensions/i2p/p/expire.rb',
            #'ruby ./extensions/i2p/p/ipn.rb',
            #'ruby ./extensions/i2p/p/movement.rb',
            'puma',
        ],
    },
=end
}

# Database Node
#
BlackOps.add_node({
    :name => 'db',
    :ip => '127.0.0.1',

    :install_ops => [
        'hostname.op',
        'mysaas.install.ubuntu_22_04.base.op',
        'mysaas.install.ubuntu_22_04.postgresql.op',
    ],

    :deploy_ops => [
        # no deployment ops
    ],

    :migration_folders => [
        # no migration ops
    ],

    :start_ops => [
        # no start ops
    ],

    :stop_ops => [
        # no stop ops
    ],

}.merge(
    @t[:ssh],
    @t[:postgres],
))

# Web Server Node
#
BlackOps.add_node({
    :name => 'web',

    # Webserver IP, domain and port
    # NOTE: In a local environment, domain is 127.0.0.1.
    #
    :ip => '127.0.0.1',
    :domain => '127.0.0.1',
    :port => '3000',

    # API key of the super-user
    :su_api_key => SU_API_KEY,

    # GitHub repository and branch of the source code.
    :git_repository => 'leandrosardi/my.saas',
    :git_branch => 'main',

    # folder inside /home/$$ssh_username/code1
    :code_folder => 'my.saas', 

    # Used to sign and encrypt session cookies for security. This should be a long,
    # random, and unique string. In production, do NOT hardcode this — Setup it in
    # your BlackOpsFile.
    :session_secret => SESSION_SECRET,

    # name of database to connect
    :postgres_database => POSTGRES_DATABASE,

    :install_ops => [
        'hostname.op',
        'mysaas.install.ubuntu_22_04.base.op',
        'mysaas.install.ubuntu_22_04.service.op',
        #'mysaas.install.ubuntu_22_04.nginx.op', # ==> nginx installation is not required in local environment
        
        # Invoicing and Payments Processing extension.
        #'i2p.install',
        
        # CMS extension.
        #'content.install',
        
        # Security and Users Monitoring extension.
        #'monitoring.install',
    ],

    :deploy_ops => [
        'mysaas.deploy.base.op',

        # Transactional emails - Setup SMTP parameters in `config.rb`
        #'mysaas.deploy.transactional-emails.op',

        # Invoicing and Payments Processing extension.
        #'i2p.deploy',
        
        # CMS extension.
        #'content.deploy',
        
        # Security and Users Monitoring extension.
        #'monitoring.deploy',
    ],

    :migration_folders => [
        "/home/#{SSH_USERNAME}/code1/my.saas/sql",

        # Invoicing and Payments Processing extension.
        #"/home/#{SSH_USERNAME}/code1/my.saas/extensions/i2p/sql",

        # CMS extension.
        #"/home/#{SSH_USERNAME}/code1/my.saas/extensions/content/sql",

        # Security and Users Monitoring extension.
        #"/home/#{SSH_USERNAME}/code1/my.saas/extensions/monitoring/sql",
    ],

    :start_ops => [
        'mysaas.start.op',

        # Invoicing and Payments Processing extension.
        #'i2p.start',
        
        # CMS extension.
        #'content.start',
        
        # Security and Users Monitoring extension.
        #'monitoring.start',
    ],

    :stop_ops => [
        'mysaas.stop.op',

        # Invoicing and Payments Processing extension.
        #'i2p.stop',
        
        # CMS extension.
        #'content.stop',
        
        # Security and Users Monitoring extension.
        #'monitoring.stop',
    ],
}.merge(
    @t[:ssh],
    @t[:postgres],

    # Git credentials for secret repositories.
    #@t[:git],

    # Transactional Emails
    #@t[:emails],

    # Invoicing and Payments Processing extension.
    #@t[:i2p],

    # CMS extension.
    #@t[:content],

    # Security and Users Monitoring extension.
    #@t[:monitoring],
))