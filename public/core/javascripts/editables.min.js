/*
 * ## EDITABLES.JS
 * Editables.js
 *
 * This library follows the best practices enumarated here:
 * https://www.w3.org/community/webed/wiki/JavaScript_best_practices
 *
 */

editablesJs = {

	/*
	 * Returns the version of this commonsJs library.
	 *
	 */
	version: function() {
		return '1.0.2';
	},

	/*
	 * Turns off edition mode.
	 *
	 */
	switchToReadOnly: function(parent) {
		$(parent).find('.editable-field-readonly').css('visibility', 'visible');
		$(parent).find('.editable-field-editable').css('visibility', 'hidden');
	},

	/*
	 * Turns on edition mode.
	 *
	 */
	switchToEdition: function(parent) {
		$(parent).find('.editable-field-readonly').css('visibility', 'hidden');
		$(parent).find('.editable-field-editable').css('visibility', 'visible');
	},


	/*
	 * Retrieves the value of the read-only part of the widget.
	 *
	 */
	value: function(parent) {
		return $(parent).find('.editable-value').text();
	},

	draw: function(parent, h) {
		if ( h['value'] == null ) {
			h['value'] = '';
		}

		if ( h['placeholder'] == null ) {
			h['placeholder'] = '';
		}

		// build html
		// TODO: create jQuery objects following the jQuery best practices
		var s =
		"<div class='editable-container'> " +
		"	<div class='editable-field-readonly'> " +
		"		<span class='editable-value'>"+h['value'].toString()+"</span> " +
		"		<button title='edit' class='edit-button btn btn-link simple menu-link'><i class='icon-pencil'> </i></a> " +
		"	</div> " +
		"	<div class='editable-field-editable'> " +
		"		<input class='editable-input' placeholder='"+h['placeholder'].toString()+"' /> " +
		"		<button title='save' class='save-button btn btn-blue'>Save</button> " +
		"		<button title='cancel' class='cancel-button btn btn-gray'>Cancel</button> " +
		"	</div> " +
		"</div> ";

		// add html
		$(parent).html(s);

		// event: on click edit button
		$(parent).find('.edit-button').click(function() {
			editablesJs.switchToEdition(parent);
			$(parent).find('.editable-input').val(
				$(parent).find('.editable-value').text()
			);
			$(parent).find('.editable-input').get(0).select();
		});

		// event: on click save button
		$(parent).find('.save-button').click(function() {
			$(parent).find('.editable-value').text(
				$(parent).find('.editable-input').val()
			);
			if ( h['onsave'] != null ) {
				h['onsave']();
			};
			editablesJs.switchToReadOnly(parent);
		});

		// event: on click cancel button
		$(parent).find('.cancel-button').click(function() {
			editablesJs.switchToReadOnly(parent);
		});

		// event: on click cancel button
		$(parent).find('.editable-input').keydown(function(e) {
			if (e.which == 13) { // ENTER
				$(parent).find('.save-button').trigger('click');
			} else if (e.which == 27) { // ESC
				$(parent).find('.cancel-button').trigger('click');
			}
		});

	},
};
