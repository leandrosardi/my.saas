imagesJs = {
    urls: {},
    current_id: null,

	// images carousel functions
	update_numbers: function(id) {
		img = $(`#screenshot_modal_img_${id}[data-id="${id}"]`);
		var number = parseInt($(img).attr('data-number'));
		var total = $(`.screenshot_${id}`).length;
console.log('-------------------');
console.log(`id:${id}`);
console.log(`number:${number}`);
console.log(`total:${total}`);
		$(`#number_${id}`).html(number+1);
		$(`#total_${id}`).html(total);
	},

	next_screenshot: function(id) {
		img = $(`#screenshot_modal_img_${id}[data-id="${id}"]`);
		var number = parseInt($(img).attr('data-number'));
		var next_number = number + 1;
		var total = $(`.screenshot_${id}`).length;
		if (next_number >= total) {
    		next_number = 0;
		}
		// get the src of the next image
		let q = $(`.screenshot_${id}[data-number="${next_number}"][data-id="${id}"]`)
		let src = $(q).attr('src');
		$(img).attr('src', src);
		$(img).attr('data-number', next_number);
		// update the number
		imagesJs.update_numbers(id);
	},

	prev_screenshot: function(id) {
		img = $(`#screenshot_modal_img_${id}[data-id="${id}"]`);
		var number = parseInt($(img).attr('data-number'));
		var prev_number = number - 1;
		var total = $(`.screenshot_${id}`).length;
		if (prev_number < 0) {
	    	prev_number = total - 1;
		}
		// get the src of the next image
		let q = $(`.screenshot_${id}[data-number="${prev_number}"][data-id="${id}"]`);
		let src = $(q).attr('src');
		$(img).attr('src', src);
		$(img).attr('data-number', prev_number);
		// update the number
		imagesJs.update_numbers(id);
	},

    // draw the screenshots collection
    draw: function(parent, h) {
        let a = h.urls;

        // Clear any existing images (optional)
        parent.empty();
        id = parent.data('id');
        
        // Iterate over the array of image URLs
        a.forEach(function(url, index) {
            // Create a new img element with the specified attributes
            let img = $('<img>', {
                src: url,
                'data-number': index,
                'data-id': id,
                class: `screenshot screenshot_${id}`,
                style: 'width:100%;cursor:pointer;'
            });

            // Append the img element to the parent
            parent.append(img);
        });

        // Check if div.screenshot_modal_${id} exists, and if dif.screenshot_modal_${id} doesn't exist 
        // then create this HTML code just before the </body>
        if ($(`div.screenshot-modal-${id}`).length === 0) {
            // Define the HTML structure as a string
            const modalHTML = `
                <div id="screenshot_modal_${id}" class="screenshot-modal screenshot-modal-${id}" tabindex="-1">
                    <div style="text-align:center; position:absolute; top:50px; left:50px; width:250px; background-color:white; border:5px dashed red;" tabindex="-2">
                        <h1 style="font-size:36px;"><span id="number_${id}">0</span> / <span id="total_${id}">0</span></h1>
                    </div>
                    <img src="" id="screenshot_modal_img_${id}" data-number="" data-id='${id}' />
                    <button class="close btn btn-large btn-link" data-id='${id}'><i class="icon-remove"></i></button>
                    <button class="prev btn btn-large btn-link" data-id='${id}'><i class="icon-chevron-left"></i></button>
                    <button class="next btn btn-large btn-link" data-id='${id}'><i class="icon-chevron-right"></i></button>
                </div>
            `;
            
            // Append the HTML to the end of the <body> tag
            $('body').append(modalHTML);
            
            console.log(`screenshot_modal_${id} created and appended to the body.`);
        } else {
            console.log(`screenshot_modal_${id} already exists.`);
        }

        // open the dialog of images when click on .screenshot
        $(`.screenshot_${id}`).click(function() {
            let id = $(this).data('id');
            current_id = id;
            $(`#screenshot_modal_img_${id}`).attr('src', $(this).attr('src'));
            $(`#screenshot_modal_img_${id}`).attr('data-number', $(this).attr('data-number'));
            imagesJs.update_numbers(id);
            
            // open the modal
            $(`#screenshot_modal_${id}`).show();
        });


        // on click on the image, go to the next image
        $(`#screenshot_modal_img_${id}`).click(function() {
            imagesJs.next_screenshot(current_id);
        });

        // on click on the next button, go to the next image
        $(`#screenshot_modal_${id} .next`).click(function() {
            imagesJs.next_screenshot(current_id);
        });

        // on click on the prev button, go to the prev image
        $(`#screenshot_modal_${id} .prev`).click(function() {
            imagesJs.prev_screenshot(current_id);
        });

        // on click on .close, hide the screenshot modal
        $(`#screenshot_modal_${id} .close`).click(function() {
            $(`#screenshot_modal_${current_id}`).hide();
        });

        // jquery doens't erase any previous implementation of document.keyup event,
        // but add this code to any existing one instead.
        //
        // on press escape, hide the screenshot modal
        // on press arrow-left, go to previous image
        // on press arrow-right, go to next image
        $(document).keyup(function(e) {
            if (e.keyCode == 27) {
                $(`.screenshot-modal`).hide();
            }

            if (e.keyCode == 39) {
console.log('a');
                imagesJs.next_screenshot(current_id);
            }

            if (e.keyCode == 37) {
console.log('b');
                imagesJs.prev_screenshot(current_id);
            }
        });
    },
}; 