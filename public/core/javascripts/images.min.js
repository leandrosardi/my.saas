imagesJs = {
    urls: {},

	// images carousel functions
	update_numbers: function(id) {
		img = $('#screenshot_modal_img[data-id="' + id + '"]');
		var number = parseInt($(img).attr('data-number'));
		var total = $(".screenshot").length;
		$('#number').html(number+1);
		$('#total').html(total);
	},

	next_screenshot: function(id) {
		img = $('#screenshot_modal_img[data-id="' + id + '"]');
		var number = parseInt($(img).attr('data-number'));
		var next_number = number + 1;
		var total = $(".screenshot").length;
		if (next_number >= total) {
    		next_number = 0;
		}
		// get the src of the next image
		let q = $('.screenshot[data-number="' + next_number + '"][data-id="' + id + '"]')
		let src = $(q).attr('src');
		$(img).attr('src', src);
		$(img).attr('data-number', next_number);
		// update the number
		imagesJs.update_numbers(id);
	},

	prev_screenshot: function(id) {
		img = $('#screenshot_modal_img[data-id="' + id + '"]');
		var number = parseInt($(img).attr('data-number'));
		var prev_number = number - 1;
		var total = $(".screenshot").length;
		if (prev_number < 0) {
	    	prev_number = total - 1;
		}
		// get the src of the next image
		let q = $('.screenshot[data-number="' + prev_number + '"][data-id="' + id + '"]');
		let src = $(q).attr('src');
		$(img).attr('src', src);
		$(img).attr('data-number', prev_number);
		// update the number
		imagesJs.update_numbers(id);
	},

    // draw the screenshots collection
    draw: function(parent, h) {
        let a = h.urls;

        // Clear any existing images (optional)
        parent.empty();
        id = parent.data('id');

        // Iterate over the array of image URLs
        a.forEach(function(url, index) {
            // Create a new img element with the specified attributes
            let img = $('<img>', {
                src: url,
                'data-number': index,
                'data-id': id,
                class: 'screenshot',
                style: 'width:100%;cursor:pointer;'
            });

            // Append the img element to the parent
            parent.append(img);
        });
                
        // Check if div.screenshot_modal exists, and if dif.screenshot_modal doesn't exist 
        // then create this HTML code just before the </body>
        if ($('div.screenshot-modal').length === 0) {
            // Define the HTML structure as a string
            const modalHTML = `
                <div id="screenshot_modal" class="screenshot-modal" tabindex="-1">
                    <div style="text-align:center; position:absolute; top:50px; left:50px; width:250px; background-color:white; border:5px dashed red;" tabindex="-2">
                        <h1 style="font-size:36px;"><span id="number">0</span> / <span id="total">0</span></h1>
                    </div>
                    <img src="" id="screenshot_modal_img" data-number="" data-id='${id}' />
                    <button class="close btn btn-large btn-link"><i class="icon-remove"></i></button>
                    <button class="prev btn btn-large btn-link"><i class="icon-chevron-left"></i></button>
                    <button class="next btn btn-large btn-link"><i class="icon-chevron-right"></i></button>
                </div>
            `;
            
            // Append the HTML to the end of the <body> tag
            $('body').append(modalHTML);
            
            console.log("screenshot_modal created and appended to the body.");
        } else {
            console.log("screenshot_modal already exists.");
        }

        // open the dialog of images when click on .screenshot
        $(".screenshot").click(function() {
            $("#screenshot_modal_img").attr('src', $(this).attr('src'));
            $("#screenshot_modal_img").attr('data-number', $(this).attr('data-number'));
            imagesJs.update_numbers(id);
            
            // on click on the image, go to the next image
            $("#screenshot_modal_img").click(function() {
                imagesJs.next_screenshot(id);
            });

            // on click on the next button, go to the next image
            $("#screenshot_modal .next").click(function() {
                imagesJs.next_screenshot(id);
            });

            // on click on the prev button, go to the prev image
            $("#screenshot_modal .prev").click(function() {
                imagesJs.prev_screenshot(id);
            });

            // on click on .close, hide the screenshot modal
            $("#screenshot_modal .close").click(function() {
                $("#screenshot_modal").hide();
            });

            // jquery doens't erase any previous implementation of document.keyup event,
            // but add this code to any existing one instead.
            //
            // on press escape, hide the screenshot modal
            // on press arrow-left, go to previous image
            // on press arrow-right, go to next image
            $(document).keyup(function(e) {
                if (e.keyCode == 27) {
                    $("#screenshot_modal").hide();
                }

                if (e.keyCode == 39) {
                    imagesJs.next_screenshot(id);
                }

                if (e.keyCode == 37) {
                    imagesJs.prev_screenshot(id);
                }
            });

            // open the modal
            $("#screenshot_modal").show();
        });
    },
}; 